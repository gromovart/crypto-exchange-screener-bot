#!/bin/bash

echo "ðŸ“… Ð•Ð–Ð•Ð”ÐÐ•Ð’ÐÐžÐ• Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð• Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«"
echo "================================="
echo "Ð”Ð°Ñ‚Ð°: $(date)"
echo ""

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ Ð´Ð»Ñ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð²
REPORT_DIR="reports/daily_$(date +%Y%m%d)"
mkdir -p "$REPORT_DIR"

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ñ‚ÐµÑÑ‚Ñ‹
echo "1. Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ..."
make full-test 2>&1 | tee "$REPORT_DIR/full_test.log"

echo ""
echo "2. Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð° Ð¾ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ð¸..."
make coverage 2>&1 | tee "$REPORT_DIR/coverage.log"

echo ""
echo "3. Ð¢ÐµÑÑ‚ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸..."
make performance-test 2>&1 | tee "$REPORT_DIR/performance.log"

echo ""
echo "4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸..."
make security-check 2>&1 | tee "$REPORT_DIR/security.log"

echo ""
echo "5. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¸Ñ‚Ð¾Ð³Ð¾Ð²Ð¾Ð³Ð¾ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð°..."

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¸Ñ‚Ð¾Ð³Ð¾Ð²Ñ‹Ð¹ Ð¾Ñ‚Ñ‡ÐµÑ‚
cat > "$REPORT_DIR/summary.md" << EOF
# Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡ÐµÑ‚ Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸
Ð”Ð°Ñ‚Ð°: $(date)

## Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ

### 1. ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
\`\`\`
$(tail -10 "$REPORT_DIR/full_test.log")
\`\`\`

### 2. ÐŸÐ¾ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ ÐºÐ¾Ð´Ð°
\`\`\`
$(tail -5 "$REPORT_DIR/coverage.log")
\`\`\`

### 3. ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ
\`\`\`
$(tail -5 "$REPORT_DIR/performance.log")
\`\`\`

### 4. Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ
\`\`\`
$(tail -5 "$REPORT_DIR/security.log")
\`\`\`

## Ð¡Ñ‚Ð°Ñ‚ÑƒÑ
$(if grep -q "ÐžÐ¢Ð›Ð˜Ð§ÐÐ«Ð™ Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢" "$REPORT_DIR/full_test.log"; then
    echo "âœ… Ð’Ð¡Ð• Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ« Ð ÐÐ‘ÐžÐ¢ÐÐ®Ð¢ ÐÐžÐ ÐœÐÐ›Ð¬ÐÐž"
elif grep -q "Ð£Ð”ÐžÐ’Ð›Ð•Ð¢Ð’ÐžÐ Ð˜Ð¢Ð•Ð›Ð¬ÐÐž" "$REPORT_DIR/full_test.log"; then
    echo "âš ï¸  Ð¢Ð Ð•Ð‘Ð£Ð•Ð¢Ð¡Ð¯ Ð’ÐÐ˜ÐœÐÐÐ˜Ð•"
else
    echo "âŒ ÐšÐ Ð˜Ð¢Ð˜Ð§Ð•Ð¡ÐšÐ˜Ð• ÐžÐ¨Ð˜Ð‘ÐšÐ˜"
fi)
EOF

echo "âœ… Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾Ðµ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾"
echo "ðŸ“ ÐžÑ‚Ñ‡ÐµÑ‚Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹ Ð²: $REPORT_DIR"
echo ""
echo "ðŸ“‹ ÐšÑ€Ð°Ñ‚ÐºÐ¸Ð¹ Ð¾Ñ‚Ñ‡ÐµÑ‚:"
cat "$REPORT_DIR/summary.md" | tail -10